<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>è®°å¿†å¡ç‰Œæ¸¸æˆ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #gameBoard {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    .card {
      width: 100px;
      height: 100px;
      border: 1px solid #000;
      line-height: 100px;
      font-size: 40px;
      cursor: pointer;
      user-select: none;
      background-color: #f0f0f0;
    }
    .card.flipped {
      background-color: #fff;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- åˆå§‹ç•Œé¢ -->
  <div id="welcomeScreen">
    <h1>è®°å¿†å¡ç‰Œæ¸¸æˆ</h1>
    <button id="startGameButton">Start Game</button>
  </div>

  <!-- æ¸¸æˆç•Œé¢ -->
  <div id="gameScreen" style="display: none;">
    <div id="gameInfo">
      <p id="teamInfo"></p>
      <p id="playerInfo"></p>
      <p id="flipCountInfo"></p>
    </div>
    <div id="gameBoard">
      <!-- å¡ç‰Œå°†åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <!-- ç»“æœå’Œæƒ©ç½šç•Œé¢ -->
  <div id="resultScreen" style="display: none;">
    <p id="resultText"></p>
    <div id="penaltyOptions" style="display: none;">
      <button class="penaltyButton" data-penalty="å­¦çŒ«å«">è¾“çš„é˜Ÿä¼å­¦çŒ«å«</button>
      <button class="penaltyButton" data-penalty="è¡¨ç™½">è¾“çš„é˜Ÿä¼åˆ†åˆ«å‘èµ¢å¾—é˜Ÿä¼1å·å’Œ2å·è¡¨ç™½</button>
      <button class="penaltyButton" data-penalty="å–é…’">è¾“çš„é˜Ÿä¼å–ä¸€æ¯é…’</button>
      <button class="penaltyButton" data-penalty="å›ç­”é—®é¢˜">è¾“çš„é˜Ÿä¼å›ç­”èµ¢å¾—é˜Ÿä¼ä¸€ä¸ªé—®é¢˜</button>
    </div>
    <button id="restartButton" style="display: none;">Restart</button>
  </div>

  <script>
    // å…¨å±€å˜é‡è®¾ç½®
    const fruits = ["ğŸ", "ğŸŒ", "ğŸ‡", "ğŸŠ", "ğŸ‰", "ğŸ", "ğŸ‘", "ğŸ’"];
    let cards = [];
    let firstCard = null;
    let lockBoard = false;
    let currentTeam = "red"; // "red" æˆ– "blue"
    let currentPlayerIndex = 0; // 0 è¡¨ç¤ºé˜Ÿå‘˜1ï¼Œ1 è¡¨ç¤ºé˜Ÿå‘˜2
    let redFlips = [0, 0]; // çº¢é˜Ÿå„ç©å®¶ç¿»è½¬æ¬¡æ•°
    let blueFlips = [0, 0]; // è“é˜Ÿå„ç©å®¶ç¿»è½¬æ¬¡æ•°
    let matchedCount = 0;
    const totalCards = 16;

    // æ´—ç‰Œå‡½æ•°ï¼ˆFisher-Yates ç®—æ³•ï¼‰
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
         const j = Math.floor(Math.random() * (i + 1));
         [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // åˆå§‹åŒ–å¡ç‰Œé¢æ¿
    function initBoard() {
      // å°†8ç§æ°´æœå„å¤åˆ¶ä¸€æ¬¡ï¼Œç»„æˆ16å¼ å¡ç‰Œ
      const fruitPairs = fruits.concat(fruits);
      const shuffledFruits = shuffle(fruitPairs.slice());
      cards = [];
      matchedCount = 0;
      const boardDiv = document.getElementById("gameBoard");
      boardDiv.innerHTML = "";
      for (let i = 0; i < totalCards; i++) {
        const card = document.createElement("div");
        card.classList.add("card");
        card.dataset.fruit = shuffledFruits[i];
        card.dataset.flipped = "false";
        card.innerText = "ğŸ™‚"; // èƒŒé¢ç¬‘è„¸
        card.addEventListener("click", onCardClick);
        boardDiv.appendChild(card);
      }
    }

    // å¡ç‰Œç‚¹å‡»äº‹ä»¶å¤„ç†
    function onCardClick(e) {
      if (lockBoard) return;
      const card = e.currentTarget;
      if (card.dataset.flipped === "true") return; // å·²ç»ç¿»å¼€æˆ–åŒ¹é…è¿‡çš„å¡ç‰Œä¸å“åº”

      // ç¿»å¼€å¡ç‰Œæ˜¾ç¤ºæ°´æœå›¾æ¡ˆ
      flipCard(card);

      // å¢åŠ å½“å‰ç©å®¶çš„ç¿»è½¬æ¬¡æ•°
      if (currentTeam === "red") {
        redFlips[currentPlayerIndex]++;
      } else {
        blueFlips[currentPlayerIndex]++;
      }
      updateFlipCountInfo();

      if (!firstCard) {
        firstCard = card;
        return;
      }
      // é¿å…é‡å¤ç‚¹å‡»åŒä¸€å¼ å¡ç‰Œ
      if (card === firstCard) return;

      // æ£€æŸ¥ä¸¤å¼ å¡ç‰Œæ˜¯å¦åŒ¹é…
      if (card.dataset.fruit === firstCard.dataset.fruit) {
        // åŒ¹é…æˆåŠŸï¼Œä¿æŒæ­£é¢æ˜¾ç¤º
        card.dataset.matched = "true";
        firstCard.dataset.matched = "true";
        firstCard = null;
        matchedCount += 2;
        if (matchedCount === totalCards) {
          // å½“å‰é˜Ÿå®Œæˆï¼Œå»¶æ—¶åç»“æŸæœ¬å±€
          setTimeout(endRound, 500);
        }
        // åŒä¸€ç©å®¶ç»§ç»­æ“ä½œï¼Œä¸åˆ‡æ¢ç©å®¶
      } else {
        // æœªåŒ¹é…æˆåŠŸï¼Œå»¶æ—¶åç¿»å›èƒŒé¢ï¼Œå¹¶åˆ‡æ¢åˆ°åŒé˜Ÿä¸‹ä¸€ä½ç©å®¶
        lockBoard = true;
        setTimeout(() => {
          unflipCard(card);
          unflipCard(firstCard);
          firstCard = null;
          lockBoard = false;
          switchPlayer();
        }, 1000);
      }
    }

    // ç¿»ç‰Œï¼šæ˜¾ç¤ºæ­£é¢æ°´æœå›¾æ¡ˆ
    function flipCard(card) {
      card.innerText = card.dataset.fruit;
      card.dataset.flipped = "true";
      card.classList.add("flipped");
    }

    // è¿˜åŸç‰Œé¢ï¼šæ˜¾ç¤ºèƒŒé¢ç¬‘è„¸
    function unflipCard(card) {
      card.innerText = "ğŸ™‚";
      card.dataset.flipped = "false";
      card.classList.remove("flipped");
    }

    // æ›´æ–°å½“å‰é˜Ÿä¼å’Œç©å®¶ä¿¡æ¯æ˜¾ç¤º
    function updateGameInfo() {
      const teamInfo = document.getElementById("teamInfo");
      const playerInfo = document.getElementById("playerInfo");
      if (currentTeam === "red") {
        teamInfo.innerText = "å½“å‰é˜Ÿä¼ï¼šçº¢é˜Ÿ";
        playerInfo.innerText = "å½“å‰ç©å®¶ï¼šçº¢é˜Ÿ" + (currentPlayerIndex + 1) + "å·";
      } else {
        teamInfo.innerText = "å½“å‰é˜Ÿä¼ï¼šè“é˜Ÿ";
        playerInfo.innerText = "å½“å‰ç©å®¶ï¼šè“é˜Ÿ" + (currentPlayerIndex + 1) + "å·";
      }
    }

    // æ›´æ–°ç¿»è½¬æ¬¡æ•°æ˜¾ç¤º
    function updateFlipCountInfo() {
      const flipCountInfo = document.getElementById("flipCountInfo");
      if (currentTeam === "red") {
        flipCountInfo.innerText = "çº¢é˜Ÿ1å·ï¼š" + redFlips[0] + " æ¬¡ï¼Œçº¢é˜Ÿ2å·ï¼š" + redFlips[1] + " æ¬¡";
      } else {
        flipCountInfo.innerText = "è“é˜Ÿ1å·ï¼š" + blueFlips[0] + " æ¬¡ï¼Œè“é˜Ÿ2å·ï¼š" + blueFlips[1] + " æ¬¡";
      }
    }

    // åˆ‡æ¢åˆ°å½“å‰é˜Ÿä¼çš„ä¸‹ä¸€ä½ç©å®¶
    function switchPlayer() {
      currentPlayerIndex = (currentPlayerIndex + 1) % 2;
      updateGameInfo();
    }

    // å½“æ‰€æœ‰å¡ç‰ŒåŒ¹é…å®Œæ¯•ï¼Œç»“æŸå½“å‰é˜Ÿä¼å›åˆ
    function endRound() {
      if (currentTeam === "red") {
        alert("çº¢é˜Ÿå®Œæˆï¼æ€»ç¿»è½¬æ¬¡æ•°ï¼š" + (redFlips[0] + redFlips[1]) + " æ¬¡");
        // åˆ‡æ¢åˆ°è“é˜Ÿå›åˆ
        currentTeam = "blue";
        currentPlayerIndex = 0;
        initBoard();
        updateGameInfo();
        updateFlipCountInfo();
      } else {
        alert("è“é˜Ÿå®Œæˆï¼æ€»ç¿»è½¬æ¬¡æ•°ï¼š" + (blueFlips[0] + blueFlips[1]) + " æ¬¡");
        // ä¸¤é˜Ÿå‡å®Œæˆåæ˜¾ç¤ºç»“æœ
        showResult();
      }
    }

    // æ˜¾ç¤ºæ¯”èµ›ç»“æœå’Œæƒ©ç½šé€‰é¡¹
    function showResult() {
      const redTotal = redFlips[0] + redFlips[1];
      const blueTotal = blueFlips[0] + blueFlips[1];
      const resultScreen = document.getElementById("resultScreen");
      resultScreen.style.display = "block";
      document.getElementById("gameScreen").style.display = "none";
      let resultText = "";
      if (redTotal < blueTotal) {
        resultText = "çº¢é˜Ÿè·èƒœï¼çº¢é˜Ÿæ€»ç¿»è½¬æ¬¡æ•°ï¼š" + redTotal + " æ¬¡ï¼Œè“é˜Ÿæ€»ç¿»è½¬æ¬¡æ•°ï¼š" + blueTotal + " æ¬¡ã€‚è¯·é€‰æ‹©æƒ©ç½šï¼š";
      } else if (blueTotal < redTotal) {
        resultText = "è“é˜Ÿè·èƒœï¼è“é˜Ÿæ€»ç¿»è½¬æ¬¡æ•°ï¼š" + blueTotal + " æ¬¡ï¼Œçº¢é˜Ÿæ€»ç¿»è½¬æ¬¡æ•°ï¼š" + redTotal + " æ¬¡ã€‚è¯·é€‰æ‹©æƒ©ç½šï¼š";
      } else {
        resultText = "å¹³å±€ï¼çº¢é˜Ÿæ€»ç¿»è½¬æ¬¡æ•°ï¼š" + redTotal + " æ¬¡ï¼Œè“é˜Ÿæ€»ç¿»è½¬æ¬¡æ•°ï¼š" + blueTotal + " æ¬¡ã€‚è¯·é€‰æ‹©æƒ©ç½šï¼š";
      }
      document.getElementById("resultText").innerText = resultText;
      // æ˜¾ç¤ºæƒ©ç½šé€‰é¡¹
      document.getElementById("penaltyOptions").style.display = "block";
    }

    // æƒ©ç½šé€‰é¡¹ç‚¹å‡»å¤„ç†
    function onPenaltySelected(e) {
      const penalty = e.currentTarget.dataset.penalty;
      alert("é€‰æ‹©æƒ©ç½šï¼š" + penalty);
      // æ˜¾ç¤ºRestartæŒ‰é’®
      document.getElementById("restartButton").style.display = "block";
      document.getElementById("penaltyOptions").style.display = "none";
    }

    // é‡ç½®æ¸¸æˆï¼Œè¿”å›åˆå§‹ç•Œé¢
    function restartGame() {
      currentTeam = "red";
      currentPlayerIndex = 0;
      redFlips = [0, 0];
      blueFlips = [0, 0];
      firstCard = null;
      lockBoard = false;
      matchedCount = 0;
      document.getElementById("resultScreen").style.display = "none";
      document.getElementById("restartButton").style.display = "none";
      document.getElementById("gameScreen").style.display = "none";
      document.getElementById("welcomeScreen").style.display = "block";
    }

    // ä¸ºæ‰€æœ‰æƒ©ç½šæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
    document.querySelectorAll(".penaltyButton").forEach(btn => {
      btn.addEventListener("click", onPenaltySelected);
    });

    // RestartæŒ‰é’®äº‹ä»¶ç›‘å¬
    document.getElementById("restartButton").addEventListener("click", restartGame);

    // Start GameæŒ‰é’®äº‹ä»¶ç›‘å¬
    document.getElementById("startGameButton").addEventListener("click", function(){
      document.getElementById("welcomeScreen").style.display = "none";
      document.getElementById("gameScreen").style.display = "block";
      initBoard();
      updateGameInfo();
      updateFlipCountInfo();
    });
  </script>
</body>
</html>
